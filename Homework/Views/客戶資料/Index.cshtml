@model IEnumerable<Homework.Models.客戶資料>

@{
    ViewBag.Title = "Index";
}

<h2>Index</h2>
@if (TempData["客戶資料Item"] != null && TempData["客戶資料msg"] != null)
{
    var item = TempData["客戶資料Item"] as Homework.Models.客戶資料;
    var msg = TempData["客戶資料msg"].ToString();
    <pre>@item.客戶名稱 @msg</pre>
}
@if (TempData["客戶資料error_msg"] != null)
{
    var error_msg = TempData["客戶資料error_msg"].ToString();
    <pre>@error_msg</pre>
}
<p>
    @Html.ActionLink("新增", "Create", null, new { @class = "btn btn-info" })
    @Html.ActionLink("查詢", "Query", null, new { @class = "btn btn-success" })    
</p>
@using (Html.BeginForm())
{
    <div class="form-group">
        <div class="control-label col-md-2">客戶分類</div>
        <div class="col-md-10">
            @Html.DropDownList("客戶分類", null, "請選擇", new { @onchange = "catalog_change(this.value)" })
            <button  type="submit" value="篩選" class="btn btn-default">篩選</button>
        </div>
    </div>
}

<table class="table" id="客戶資料Table">
    <tr>
        <th>
            @Html.DisplayNameFor(model => model.客戶名稱)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.統一編號)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.電話)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.傳真)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.地址)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Email)
        </th>
        <th></th>
    </tr>

@foreach (var item in Model) {
    <tr>
        <td>
            @Html.DisplayFor(modelItem => item.客戶名稱)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.統一編號)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.電話)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.傳真)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.地址)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.Email)
        </td>
        <td>
            @Html.ActionLink("Edit", "Edit", new { id=item.Id }, new { @class = "btn btn-default" }) 
            @Html.ActionLink("Details", "Details", new { id=item.Id }, new { @class = "btn btn-default" }) 
            @Html.ActionLink("Delete", "Delete", new { id = item.Id }, new { onclick = "return confirm('確定要刪除資料?');" ,@class = "btn btn-default" })
        </td>
    </tr>
}

</table>

    <div id="cust_grid"></div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
}
<script src="@Url.Content("~/Scripts/jquery-3.1.1.js")" type="text/javascript">
</script>
<script type="text/javascript">
    function catalog_change(value) {
        $("#catalog").html(value);
    };

    $(document).ready(function () {
        //$("#客戶資料change").on("change", function () {
        //    $("#catalog").val();
        //});
        $("#Reload").click(function () {
            //debugger;
            var params = new Object();
            params.catalog = $("#catalog").html();
            $.ajax({
                type: "POST", //HTTP POST Method
                contentType: "application/json; charset=utf-8",
                url: "/客戶資料/Index",
                data: JSON.stringify(params),
                dataType: "json",
                success: function (data) {
                    $("#cust_grid").load("/客戶資料/reload")
                }
            })
        })
    });
    
</script>